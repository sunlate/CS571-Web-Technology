<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

<title>Homework 4</title>
<style>
    h1{text-align: center;
    }
    form{text-align: center;
    }
</style>
</head>
<body>
    <!--HTML code for the Initial Input-->
    <h1>Enter URL for Trucking List JSON file</h1>
    <form name="myform" method="POST" id="location">
    <input type="text" name="URL" maxlength="255" size= "100"
           value= ""/>
    <br/>
    <input type="button" name="submit" value="Submit Query"
           onClick="viewJSON(this.form)"/>

    </form>

    <!--step1: writign HTML/JS program--using DOM Parser:Use DOM API to load and parse a JSON document into a DOM tree, and then use the DOM API to extract information from that document. -->
       <!--viewXML Routine-->
    <script type="text/javascript">
        var jsonObj;
        function viewJSON(what){
        var URL= what.URL.value;
            function loadJSON(url){
 //<!--error handling-->
                 //error:no file name
               if(URL===""){
                   alert("Missing file name. Please input a file name.");
                   return false;
               }

                if(window.XMLHttpRequest)
                    {//code for IE7+,Firefox, Chrome, Opera, Safari
                        xmlhttp=new XMLHttpRequest();
                    }else{//code for IE6,IE5
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}
                xmlhttp.open("GET",url,false);//"synchronous" open,send, responseText are properties of XMLHTTPRequest
                xmlhttp.overrideMimeType("application/json");

                //error:file not exists
                try{
                    xmlhttp.send();
                    jsonObj=JSON.parse(xmlhttp.responseText);
                    if(xmlhttp.status===404){
                    }
                }
                catch(err){
                    alert("File not exists");
                    return false;
                    }

                return jsonObj;
            }
            jsonObj=loadJSON(URL);

            //error:containing NO trucking companies
            if(jsonObj.Mainline.Table.hasOwnProperty('Row')==false){
               alert("JSON file does not contain company entries");
                return false;
               }
            else if(window.ActiveXObject)//if IE,simply execute script(due to asnc prop).
                { if(jsonObj.parseError.errorCode!=0){
                    var myErr=jsonObj.parseError;
                    generateError(jsonObj);
                    hWin=window.open("","Error","height=300,width=340");
                    hWin.document.write(html_text);
                }else{ generateHTML(jsonObj);
                hWin=window.open("","Assignment4","height=800,width=600");
                hWin.document.write(html_text);}
                }else//else if FF,execute script once JSON object has loaded
                {jsonObj.onload=generateHTML(jsonObj);
                hWin=window.open("","Assignment4","height=800,width=600");
                hWin.document.write(html_text);}
                hWin.document.close();
                }


    <!--generateXML Routine-->
        function generateHTML(jsonObj)   {
            root=jsonObj.DocumentElement;
            html_text="<html><body>";
            html_text+="<table border='2'>";
            headerNodeList=jsonObj.Mainline.Table.Header.Data;//an array of header

            html_text+="</tbody>";
            html_text+="<tr>";
            x=0;y=0;

            //output the headers
            var header_keys=Object.keys(headerNodeList);
            for(i=0;i<header_keys.length;i++){
                header=headerNodeList[i];
                html_text+="<th>"+header+"</th>";
            }
            html_text+="</tr>";


            //output the values
            row=jsonObj.Mainline.Table.Row;//an array of row
            rowElement=row[0];//get an object
            var rowkeys = Object.keys(rowElement);

            for(i=0;i<row.length;i++)//loop for objects(each row)
            {
                html_text +="<tr>";
                rowElement=row[i];//get content from each "row" object
                for(j=0;j<rowkeys.length;j++){//loop for each value of colomn
                    colomnValue = rowkeys[j];
                    if(rowkeys[j]=="HomePage"){//print link
                        html_text+="<td><a href='"+rowElement[colomnValue]+"'>"+rowElement[colomnValue]+"</a></td>";
                    }
                    else if(rowkeys[j]=="Logo" || j==5){//print image
                       html_text+="<td><img src='"+rowElement[colomnValue]+"' width='128' height='128'></td>"
                    }

                    // If the value of a tag is empty, you should display a blank cell.
                    else if(rowkeys[j]=="Hubs"){
                      html_text += "<td>";
                         hubs=row[i].Hubs;//get hubs object  ;equals to jsonObj.Mainline.Table.Row[i].Hubs

                        for(var hubkey in hubs ) {//loop each hub of the "Hubs" ;hubkey is name of "Hub" element
                            html_text += "<ul>";
                            if (hubs[hubkey].length!=0){
                                html_text += "<li>"+hubs[hubkey][0].bold()+"</li>";
                                for(k=1;k<hubs[hubkey].length;k++){//loop each string of the "Hub" array
                                    html_text += "<li>"+ hubs[hubkey][k]+"</li>";
                                }
                            }
                            html_text += "</ul>";
                        }
                        html_text += "</td>";
                    }
                    else{html_text+="<td>"+rowElement[colomnValue]+"</td>";//print text
                        }
                }
                html_text +="</tr>";
            }
            html_text+="</tbody>";
            html_text+="</table>";
            html_text+="</body></html>";
        }
   </script>

</body>
</html>
